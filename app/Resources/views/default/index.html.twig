{% extends 'base.html.twig' %}

{% block stylesheets %}
    {% stylesheets '@bootstrap_css' %}
    <link rel="stylesheet" type="text/css" media="screen" href="{{ asset_url }}"/>
    {% endstylesheets %}
    {% javascripts '@jquery' %}
    <script src="{{ asset_url }}" type="text/javascript"></script>
    {% endjavascripts %}
{% endblock %}

{% block title %}
    Chat!
{% endblock %}

{% block body %}
    </div>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

    <div class="container">

        <div class="row">
            <div class="row">
                <div class="col-lg-3">
                    <div class="btn-panel btn-panel-conversation" align="center">
                        <div class="msg" style="color: white; background-color: #337ab7">
                            Your friends list
                        </div>
                    </div>
                </div>
                <div class="col-lg-3" style="width: 200px">
                </div>
                <div class="col-lg-3">
                    <div class="btn-panel">
                        <a href="/profile" class=" col-lg-4 text-right btn   send-message-btn pull-right"
                           style="color: black; background-color: rgb(240,240,240)"
                           role="button">
                            Profile
                        </a>
                    </div>
                </div>
                <div class="col-lg-3" >
                    <div class="btn-panel">
                        <a href="/logout" class=" col-lg-4 text-right btn   send-message-btn pull-left"
                           role="button" style="color: black; background-color: rgb(240,240,240)" >
                            Logout
                        </a>
                    </div>
                </div>
            </div>

            <div class="conversation-wrap col-lg-3">

                {% for friend in friendsList %}
                    <div class="media conversation">
                        <label class="pull-left" href="#">
                            <img class="media-object" data-src="holder.js/64x64" alt="64x64" style="width: 50px; height: 50px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACqUlEQVR4Xu2Y60tiURTFl48STFJMwkQjUTDtixq+Av93P6iBJFTgg1JL8QWBGT4QfDX7gDIyNE3nEBO6D0Rh9+5z9rprr19dTa/XW2KHl4YFYAfwCHAG7HAGgkOQKcAUYAowBZgCO6wAY5AxyBhkDDIGdxgC/M8QY5AxyBhkDDIGGYM7rIAyBgeDAYrFIkajEYxGIwKBAA4PDzckpd+322243W54PJ5P5f6Omh9tqiTAfD5HNpuFVqvFyckJms0m9vf3EY/H1/u9vb0hn89jsVj8kwDfUfNviisJ8PLygru7O4TDYVgsFtDh9Xo9NBrNes9cLgeTybThgKenJ1SrVXGf1WoVDup2u4jFYhiPx1I1P7XVBxcoCVCr1UBfTqcTrVYLe3t7OD8/x/HxsdiOPqNGo9Eo0un02gHkBhJmuVzC7/fj5uYGXq8XZ2dnop5Mzf8iwMPDAxqNBmw2GxwOBx4fHzGdTpFMJkVzNB7UGAmSSqU2RoDmnETQ6XQiOyKRiHCOSk0ZEZQcUKlU8Pz8LA5vNptRr9eFCJQBFHq//szG5eWlGA1ywOnpqQhBapoWPfl+vw+fzweXyyU+U635VRGUBOh0OigUCggGg8IFK/teXV3h/v4ew+Hwj/OQU4gUq/w4ODgQrkkkEmKEVGp+tXm6XkkAOngmk4HBYBAjQA6gEKRmyOL05GnR99vbW9jtdjEGdP319bUIR8oA+pnG5OLiQoghU5OElFlKAtCGr6+vKJfLmEwm64aosd/XbDbbyIBSqSSeNKU+HXzlnFAohKOjI6maMs0rO0B20590n7IDflIzMmdhAfiNEL8R4jdC/EZIJj235R6mAFOAKcAUYApsS6LL9MEUYAowBZgCTAGZ9NyWe5gCTAGmAFOAKbAtiS7TB1Ng1ynwDkxRe58vH3FfAAAAAElFTkSuQmCC">
                        </label>
                        <div class="media-body">
                            <h5 class="media-heading" align="left">{{ friend }}</h5>
                        </div>
                    </div>
                {% endfor %}
                {% if friendsList == null %}
                    <div class="media conversation">
                        <label class="pull-left" href="#">
                        </label>
                        <div class="media-body">
                            <h5 class="media-heading" align="left"> У вас нет друзей зарегестрированных в чате</h5>
                        </div>
                    </div>
                {% endif %}
            </div>

            <div class="message-wrap col-lg-8" >
                <div class="msg-wrap" id="commentstext">

                    {% for comment in commentsList %}
                    <div class="media msg ">
                        <label class="pull-left" href="#">
                            <img class="media-object" data-src="holder.js/64x64" alt="64x64" style="width: 32px; height: 32px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACqUlEQVR4Xu2Y60tiURTFl48STFJMwkQjUTDtixq+Av93P6iBJFTgg1JL8QWBGT4QfDX7gDIyNE3nEBO6D0Rh9+5z9rprr19dTa/XW2KHl4YFYAfwCHAG7HAGgkOQKcAUYAowBZgCO6wAY5AxyBhkDDIGdxgC/M8QY5AxyBhkDDIGGYM7rIAyBgeDAYrFIkajEYxGIwKBAA4PDzckpd+322243W54PJ5P5f6Omh9tqiTAfD5HNpuFVqvFyckJms0m9vf3EY/H1/u9vb0hn89jsVj8kwDfUfNviisJ8PLygru7O4TDYVgsFtDh9Xo9NBrNes9cLgeTybThgKenJ1SrVXGf1WoVDup2u4jFYhiPx1I1P7XVBxcoCVCr1UBfTqcTrVYLe3t7OD8/x/HxsdiOPqNGo9Eo0un02gHkBhJmuVzC7/fj5uYGXq8XZ2dnop5Mzf8iwMPDAxqNBmw2GxwOBx4fHzGdTpFMJkVzNB7UGAmSSqU2RoDmnETQ6XQiOyKRiHCOSk0ZEZQcUKlU8Pz8LA5vNptRr9eFCJQBFHq//szG5eWlGA1ywOnpqQhBapoWPfl+vw+fzweXyyU+U635VRGUBOh0OigUCggGg8IFK/teXV3h/v4ew+Hwj/OQU4gUq/w4ODgQrkkkEmKEVGp+tXm6XkkAOngmk4HBYBAjQA6gEKRmyOL05GnR99vbW9jtdjEGdP319bUIR8oA+pnG5OLiQoghU5OElFlKAtCGr6+vKJfLmEwm64aosd/XbDbbyIBSqSSeNKU+HXzlnFAohKOjI6maMs0rO0B20590n7IDflIzMmdhAfiNEL8R4jdC/EZIJj235R6mAFOAKcAUYApsS6LL9MEUYAowBZgCTAGZ9NyWe5gCTAGmAFOAKbAtiS7TB1Ng1ynwDkxRe58vH3FfAAAAAElFTkSuQmCC">
                        </label>
                        <div class="media-body">
                            {% if (currentUser == comment.user) %}
                                <small class="pull-right time jsClick" data-edit-id="{{ comment.id }}" style="cursor: pointer" >
                                    Edit
                                </small>
                            {% endif %}
                            <h5 class="media-heading">{{ comment.user.username }}</h5>
                            <small class="col-lg-10"
                                   data-comment-id="{{ comment.id }}">{{ comment.commentContent }}</small>
                        </div>
                    </div>
                    {% endfor %}

                </div>

                <div class="send-wrap " required>

                    <textarea class="form-control send-message"
                              rows="3"
                              data-id = "new-comment-text"
                              placeholder="Write a comment..."></textarea>

                </div>
                <div class="btn-panel" >
                    <a href="" class=" col-lg-4 text-right btn   send-message-btn pull-right"
                       data-id = "new-comment-send"
                       role="button" style="color: black; background-color: rgb(240,240,240)">
                        <i class="fa fa-plus"></i> Send Message
                    </a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        $('#commentstext').scrollTop(9999);
        $(function() {
            $('[data-edit-id]').click(function (e) {
                var currentElement = e.target;
                var idCommentToChange = $(currentElement).data('editId');
                var commentToChange = $('[data-comment-id = ' + idCommentToChange + ']');
                var textToChange = commentToChange.text();
                var code = '<input type="text" id="editComment" value="' + textToChange + '" required size="50">';
                commentToChange.empty().append(code);
                $('#editComment').focus();
                $('#editComment').blur(function () {
                    var newText = $(this).val();
                    if (newText != '') {
                        $(this).parent().empty().html(newText);
                        if (newText !== textToChange){
                            $.post("/changeComment",{
                                "id":idCommentToChange,
                                "commentText":newText,
                            }).done(function (data) {
                                if (data != "commentSuccessfullyAdded") {
                                    alert('Изменение комментария не произошло!');
                                }
                            });
                        }
                    } else {
                        alert('Комментарий не может быть пустым!');
                        $(this).parent().empty().html(textToChange);
                    }
                })
            })
            $('[data-id = "new-comment-send"]').click(function () {
                var newText = $('[data-id = "new-comment-text"]').val();
                if (newText != '') {
                    $.post("/newComment",{
                        "commentText":newText
                    });
                } else {
                    alert('Комментарий не может быть пустым!');
                }
            })
        });
    </script>
{% endblock %}
